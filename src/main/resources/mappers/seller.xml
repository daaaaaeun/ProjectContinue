<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="seller">
    <!-- 배송정책 등록하기 -->
    <insert id="dv_insert" parameterType="com.cafe24.nonchrono.dto.DeliveryDTO">
        INSERT INTO tb_delivery ( sl_id, dv_exist, dv_how, dv_courier, dv_fee, dv_extrafee, dv_adr1, dv_adr2, dv_rffee, dv_exfee, dv_exadr1, dv_exadr2)
        VALUES ( #{sl_id}, #{dv_exist}, #{dv_how}, #{dv_courier}, #{dv_fee}, #{dv_extrafee}, #{dv_adr1}, #{dv_adr2}, #{dv_rffee}, #{dv_exfee}, #{dv_exadr1}, #{dv_exadr2})
    </insert>


    <!-- 판마자별 배송정책 리스트 -->
    <select id="dv_list" resultType="com.cafe24.nonchrono.dto.DeliveryDTO">
        select dv_num ,sl_id ,dv_how ,dv_courier ,dv_fee ,dv_extrafee ,dv_adr1 ,dv_adr2 ,dv_rffee ,dv_exfee ,dv_exadr1 ,dv_exadr2
        from tb_delivery
        where sl_id = #{sl_id}
        ORDER BY dv_num DESC
    </select>

    <select id="list" parameterType="com.cafe24.nonchrono.dto.SellerDTO">
        SELECT sl_id, sl_pw, sl_name, sl_zip, sl_adr1, sl_adr2, sl_phone, sl_birth, sl_grade, sl_receive, sl_number, sl_bank, sl_bankcode
        FROM tb_seller
        ORDER BY sl_id
    </select>

    <select id="login" parameterType="com.cafe24.nonchrono.dto.SellerDTO" resultType="String">
        SELECT sl_grade
        FROM tb_seller
        WHERE sl_id = #{sl_id} AND sl_pw = #{sl_pw} AND sl_grade IN ('SVip', 'SGold', 'SSilver', 'SBronze', 'SNew');
    </select>

    <select id="check" resultType="com.cafe24.nonchrono.dto.SellerDTO">
        SELECT sl_id
        FROM tb_seller
    </select>

    <insert id="seller_insert" parameterType="com.cafe24.nonchrono.dto.SellerDTO">
        INSERT INTO tb_seller(sl_id, sl_pw, sl_name, sl_zip, sl_adr1, sl_adr2, sl_phone, sl_birth, sl_number, sl_bank, sl_bankcode)
        VALUES (#{sl_id}, #{sl_pw}, #{sl_name}, #{sl_zip}, #{sl_adr1}, #{sl_adr2}, #{sl_phone}, #{sl_birth}, #{sl_number}, #{sl_bank}, #{sl_bankcode})
    </insert>

    <select id="progCountDay" parameterType="java.lang.String" resultType="java.util.Map">
        select tbc.dt_prog, ifnull(cnt, 0) as ct
        from (
                 select dt.dt_prog, dt.ss_num, sl_id, count(*) as cnt, od_date
                 from tb_order od join tb_detail dt
                                       on od.od_num = dt.od_num join tb_sales sl
                                                                     on dt.ss_num = sl.ss_num
                 where DATE_FORMAT(od_date, '%Y-%m-%d') = DATE_FORMAT(now(), '%Y-%m-%d') and sl_id = #{sl_id}
                 group by dt_prog
             ) tba right join (select *
                               from (
                                        select '결제완료' dt_prog from dual union all
                                        select '출고준비중' dt_prog from dual union all
                                        select '출고완료' dt_prog from dual union all
                                        select '배송중' dt_prog from dual union all
                                        select '배송완료' dt_prog from dual union all
                                        select '구매확정' dt_prog from dual union all
                                        select '교환' dt_prog from dual union all
                                        select '반품' dt_prog from dual
                                    ) tbb
        ) tbc on tba.dt_prog = tbc.dt_prog
    </select>
    
    <select id="progCountAll" parameterType="java.lang.String" resultType="java.util.Map">
        select tbc.dt_prog, ifnull(cnt, 0) as ct
        from (
                 select dt_prog, count(*) as cnt, dt.ss_num, sl.sl_id
                 from tb_detail dt join tb_sales sl
                                        on dt.ss_num = sl.ss_num join tb_order od
                                                                      on dt.od_num = od.od_num
                 where sl_id = #{sl_id}
                 group by dt_prog
                 order by dt_prog
             ) tba right join (select *
                               from (
                                        select '결제완료' dt_prog from dual union all
                                        select '출고준비중' dt_prog from dual union all
                                        select '출고완료' dt_prog from dual union all
                                        select '배송중' dt_prog from dual union all
                                        select '배송완료' dt_prog from dual union all
                                        select '구매확정' dt_prog from dual union all
                                        select '교환' dt_prog from dual union all
                                        select '반품' dt_prog from dual
                                    ) tbb
        ) tbc on tba.dt_prog = tbc.dt_prog
    </select>

    <select id="saleAmountDay" resultType="java.lang.Integer">
        select ifnull(total, 0) as totsale
        from (
                 select substr(gm_code,1,2) as gc, sum(dt_amount) as total
                 from tb_detail dt join tb_order t on dt.od_num = t.od_num
                                   join tb_sales ts on dt.ss_num = ts.ss_num
                 where sl_id = #{sl_id} and DATE_FORMAT(od_date, '%Y-%m-%d') = DATE_FORMAT(now(), '%Y-%m-%d')
                 group by gc
             ) tba right join (select *
                               from (
                                        select 'mn' gc from dual union all
                                        select 'pt' gc from dual union all
                                        select 'dt' gc from dual union all
                                        select 'dl' gc from dual union all
                                        select 'ol' gc from dual union all
                                        select 'pn' gc from dual union all
                                        select 'fc' gc from dual union all
                                        select 'am' gc from dual union all
                                        select 'pc' gc from dual union all
                                        select 'jc' gc from dual union all
                                        select 'ac' gc from dual
                                    ) tbb
        ) tbc on tba.gc = tbc.gc
    </select>
    
    <select id="saleAmountMonth" resultType="java.lang.Integer">
        select ifnull(total, 0) as totsale
        from (
                 select substr(gm_code,1,2) as gc, sum(dt_amount) as total
                 from tb_detail dt join tb_order t on dt.od_num = t.od_num
                                   join tb_sales ts on dt.ss_num = ts.ss_num
                 where sl_id = #{sl_id} and DATE_FORMAT(od_date, '%Y-%m') = DATE_FORMAT(now(), '%Y-%m')
                 group by gc
             ) tba right join (select *
                               from (
                                        select 'mn' gc from dual union all
                                        select 'pt' gc from dual union all
                                        select 'dt' gc from dual union all
                                        select 'dl' gc from dual union all
                                        select 'ol' gc from dual union all
                                        select 'pn' gc from dual union all
                                        select 'fc' gc from dual union all
                                        select 'am' gc from dual union all
                                        select 'pc' gc from dual union all
                                        select 'jc' gc from dual union all
                                        select 'ac' gc from dual
                                    ) tbb
        ) tbc on tba.gc = tbc.gc
    </select>

    <select id="saleAmountYear" resultType="java.lang.Integer">
        select ifnull(total, 0) as totsale
        from (
                 select substr(gm_code,1,2) as gc, sum(dt_amount) as total
                 from tb_detail dt join tb_order t on dt.od_num = t.od_num
                                   join tb_sales ts on dt.ss_num = ts.ss_num
                 where sl_id = #{sl_id} and DATE_FORMAT(od_date, '%Y') = DATE_FORMAT(now(), '%Y')
                 group by gc
             ) tba right join (select *
                               from (
                                        select 'mn' gc from dual union all
                                        select 'pt' gc from dual union all
                                        select 'dt' gc from dual union all
                                        select 'dl' gc from dual union all
                                        select 'ol' gc from dual union all
                                        select 'pn' gc from dual union all
                                        select 'fc' gc from dual union all
                                        select 'am' gc from dual union all
                                        select 'pc' gc from dual union all
                                        select 'jc' gc from dual union all
                                        select 'ac' gc from dual
                                    ) tbb
        ) tbc on tba.gc = tbc.gc
    </select>

    <select id="topSellingDay" resultType="java.util.Map">
        select *, ss_price * cnt as sales
        from (
                 select ss_name, ss_price, count(*) as cnt, ss_img
                 from tb_order od join tb_detail dt
                                       on od.od_num = dt.od_num join tb_sales ts
                                                                     on dt.ss_num = ts.ss_num
                 where sl_id = #{sl_id} and DATE_FORMAT(od_date, '%Y-%m-%d') = DATE_FORMAT(now(), '%Y-%m-%d')
                 group by dt.ss_num
             ) AA
        order by cnt desc, sales desc
        limit 5
    </select>

    <select id="topSellingMonth" resultType="java.util.Map">
        select *, ss_price * cnt as sales
        from (
                 select ss_name, ss_price, count(*) as cnt, ss_img
                 from tb_order od join tb_detail dt
                                       on od.od_num = dt.od_num join tb_sales ts
                                                                     on dt.ss_num = ts.ss_num
                 where sl_id = #{sl_id} and DATE_FORMAT(od_date, '%Y-%m') = DATE_FORMAT(now(), '%Y-%m')
                 group by dt.ss_num
             ) AA
        order by cnt desc, sales desc
        limit 5
    </select>

    <select id="topSellingYear" resultType="java.util.Map">
        select *, ss_price * cnt as sales
        from (
                 select ss_name, ss_price, count(*) as cnt, ss_img
                 from tb_order od join tb_detail dt
                                       on od.od_num = dt.od_num join tb_sales ts
                                                                     on dt.ss_num = ts.ss_num
                 where sl_id = #{sl_id} and DATE_FORMAT(od_date, '%Y') = DATE_FORMAT(now(), '%Y')
                 group by dt.ss_num
             ) AA
        order by cnt desc, sales desc
            limit 5
    </select>

    <select id="recentsalesDay" resultType="java.util.Map">
        select od.od_num, od_date, ts.ss_num, mem_name, ss_price, sl_id, ss_name, dt_prog
        from tb_order od join tb_detail dt
                              on od.od_num = dt.od_num join tb_mem mem
                                                            on od.mem_id = mem.mem_id join tb_sales ts
                                                                                           on dt.ss_num = ts.ss_num
        where sl_id = #{sl_id} and DATE_FORMAT(od_date, '%Y-%m-%d') = DATE_FORMAT(now(), '%Y-%m-%d')
        order by od_date desc
            limit 5
    </select>

    <select id="recentsalesMonth" resultType="java.util.Map">
        select od.od_num, od_date, ts.ss_num, mem_name, ss_price, sl_id, ss_name, dt_prog
        from tb_order od join tb_detail dt
                              on od.od_num = dt.od_num join tb_mem mem
                                                            on od.mem_id = mem.mem_id join tb_sales ts
                                                                                           on dt.ss_num = ts.ss_num
        where sl_id = #{sl_id} and DATE_FORMAT(od_date, '%Y-%m') = DATE_FORMAT(now(), '%Y-%m')
        order by od_date desc
            limit 5
    </select>

    <select id="recentsalesYear" resultType="java.util.Map">
        select od.od_num, od_date, ts.ss_num, mem_name, ss_price, sl_id, ss_name, dt_prog
        from tb_order od join tb_detail dt
                              on od.od_num = dt.od_num join tb_mem mem
                                                            on od.mem_id = mem.mem_id join tb_sales ts
                                                                                           on dt.ss_num = ts.ss_num
        where sl_id = #{sl_id} and DATE_FORMAT(od_date, '%Y') = DATE_FORMAT(now(), '%Y')
        order by od_date desc
            limit 5
    </select>
    
    <select id="budgetreportDay" resultType="java.lang.Integer">
        select ifnull(sale, 0) as sales
        from (
                 select substr(gm_code,1,2) as gc, dt_amount*ss_price as sale
                 from tb_order od join tb_detail dt
                                       on od.od_num = dt.od_num join tb_sales ts
                                                                     on dt.ss_num = ts.ss_num
                 where sl_id = #{sl_id} and DATE_FORMAT(od_date, '%Y-%m-%d') = DATE_FORMAT(now(), '%Y-%m-%d')
                 group by gc
             ) tba right join (select *
                               from (
                                        select 'mn' gc from dual union all
                                        select 'pt' gc from dual union all
                                        select 'dt' gc from dual union all
                                        select 'dl' gc from dual union all
                                        select 'ol' gc from dual union all
                                        select 'pn' gc from dual union all
                                        select 'fc' gc from dual union all
                                        select 'am' gc from dual union all
                                        select 'pc' gc from dual union all
                                        select 'jc' gc from dual union all
                                        select 'ac' gc from dual
                                    ) tbb
        ) tbc on tba.gc = tbc.gc
    </select>

    <select id="budgetreportYesterday" resultType="java.lang.Integer">
        select ifnull(sale, 0) as sales
        from (
                 select substr(gm_code,1,2) as gc, dt_amount*ss_price as sale
                 from tb_order od join tb_detail dt
                                       on od.od_num = dt.od_num join tb_sales ts
                                                                     on dt.ss_num = ts.ss_num
                 where sl_id = #{sl_id} and DATE_FORMAT(od_date, '%Y-%m-%d') = DATE_FORMAT(subdate(now(), interval 1 day), '%Y-%m-%d')
                 group by gc
             ) tba right join (select *
                               from (
                                        select 'mn' gc from dual union all
                                        select 'pt' gc from dual union all
                                        select 'dt' gc from dual union all
                                        select 'dl' gc from dual union all
                                        select 'ol' gc from dual union all
                                        select 'pn' gc from dual union all
                                        select 'fc' gc from dual union all
                                        select 'am' gc from dual union all
                                        select 'pc' gc from dual union all
                                        select 'jc' gc from dual union all
                                        select 'ac' gc from dual
                                    ) tbb
        ) tbc on tba.gc = tbc.gc
    </select>

    <select id="budgetreportMonth" resultType="java.lang.Integer">
        select ifnull(sale, 0) as sales
        from (
                 select substr(gm_code,1,2) as gc, dt_amount*ss_price as sale
                 from tb_order od join tb_detail dt
                                       on od.od_num = dt.od_num join tb_sales ts
                                                                     on dt.ss_num = ts.ss_num
                 where sl_id = #{sl_id} and DATE_FORMAT(od_date, '%Y-%m') = DATE_FORMAT(now(), '%Y-%m')
                 group by gc
             ) tba right join (select *
                               from (
                                        select 'mn' gc from dual union all
                                        select 'pt' gc from dual union all
                                        select 'dt' gc from dual union all
                                        select 'dl' gc from dual union all
                                        select 'ol' gc from dual union all
                                        select 'pn' gc from dual union all
                                        select 'fc' gc from dual union all
                                        select 'am' gc from dual union all
                                        select 'pc' gc from dual union all
                                        select 'jc' gc from dual union all
                                        select 'ac' gc from dual
                                    ) tbb
        ) tbc on tba.gc = tbc.gc
    </select>

    <select id="budgetreportLastMonth" resultType="java.lang.Integer">
        select ifnull(sale, 0) as sales
        from (
                 select substr(gm_code,1,2) as gc, dt_amount*ss_price as sale
                 from tb_order od join tb_detail dt
                                       on od.od_num = dt.od_num join tb_sales ts
                                                                     on dt.ss_num = ts.ss_num
                 where sl_id = #{sl_id} and DATE_FORMAT(od_date, '%Y-%m') = DATE_FORMAT(subdate(now(), interval 1 month), '%Y-%m')
                 group by gc
             ) tba right join (select *
                               from (
                                        select 'mn' gc from dual union all
                                        select 'pt' gc from dual union all
                                        select 'dt' gc from dual union all
                                        select 'dl' gc from dual union all
                                        select 'ol' gc from dual union all
                                        select 'pn' gc from dual union all
                                        select 'fc' gc from dual union all
                                        select 'am' gc from dual union all
                                        select 'pc' gc from dual union all
                                        select 'jc' gc from dual union all
                                        select 'ac' gc from dual
                                    ) tbb
        ) tbc on tba.gc = tbc.gc
    </select>

    <select id="budgetreportYear" resultType="java.lang.Integer">
        select ifnull(sale, 0) as sales
        from (
                 select substr(gm_code,1,2) as gc, dt_amount*ss_price as sale
                 from tb_order od join tb_detail dt
                                       on od.od_num = dt.od_num join tb_sales ts
                                                                     on dt.ss_num = ts.ss_num
                 where sl_id = #{sl_id} and DATE_FORMAT(od_date, '%Y') = DATE_FORMAT(now(), '%Y')
                 group by gc
             ) tba right join (select *
                               from (
                                        select 'mn' gc from dual union all
                                        select 'pt' gc from dual union all
                                        select 'dt' gc from dual union all
                                        select 'dl' gc from dual union all
                                        select 'ol' gc from dual union all
                                        select 'pn' gc from dual union all
                                        select 'fc' gc from dual union all
                                        select 'am' gc from dual union all
                                        select 'pc' gc from dual union all
                                        select 'jc' gc from dual union all
                                        select 'ac' gc from dual
                                    ) tbb
        ) tbc on tba.gc = tbc.gc
    </select>

    <select id="budgetreportLastYear" resultType="java.lang.Integer">
        select ifnull(sale, 0) as sales
        from (
                 select substr(gm_code,1,2) as gc, dt_amount*ss_price as sale
                 from tb_order od join tb_detail dt
                                       on od.od_num = dt.od_num join tb_sales ts
                                                                     on dt.ss_num = ts.ss_num
                 where sl_id = #{sl_id} and DATE_FORMAT(od_date, '%Y') = DATE_FORMAT(subdate(now(), interval 1 year), '%Y')
                 group by gc
             ) tba right join (select *
                               from (
                                        select 'mn' gc from dual union all
                                        select 'pt' gc from dual union all
                                        select 'dt' gc from dual union all
                                        select 'dl' gc from dual union all
                                        select 'ol' gc from dual union all
                                        select 'pn' gc from dual union all
                                        select 'fc' gc from dual union all
                                        select 'am' gc from dual union all
                                        select 'pc' gc from dual union all
                                        select 'jc' gc from dual union all
                                        select 'ac' gc from dual
                                    ) tbb
        ) tbc on tba.gc = tbc.gc
    </select>

    <select id="count" resultType="int">
        select count(*)
        from tb_sales
        where sl_id = #{sl_id}
    </select>

    <select id="paginglist" parameterType="com.cafe24.nonchrono.dto.PagingDTO" resultType="com.cafe24.nonchrono.dto.SalesDTO">
        <![CDATA[
            select *
            from (
                    select *, @rno := @rno + 1 as r
                    from (
                            select *
                            from (
                                    select ss_num, ss_name, ss_price,  ss_speriod, ss_status
                                    from tb_sales
                                    where sl_id = #{sl_id}

                                    ) AA, (select @rno := 0) BB
                            ORDER BY ss_num DESC
                    ) CC
            ) DD
            where r >= #{startRow} and r<= #{endRow}
        ]]>
    </select>

    <select id="progSearch" parameterType="java.util.Map">
        <![CDATA[
        select *
        from (
                select *, @rno := @rno + 1 as r
                from (
                        select *
                        from (
                                select od.od_num, ss_name, od_date, dt_prog
                                from tb_order od join tb_detail dt
                                on od.od_num = dt.od_num join tb_sales ts
                                on dt.ss_num = ts.ss_num
                                where sl_id = #{sl_id} and dt_prog = #{dt_prog}
                        ) AA, (select @rno := 0) BB
                        order by od_date desc
                ) CC
        ) DD
        where r >= #{startRow} and r <= #{endRow}
        ]]>
    </select>

    <!-- 판매자 상품리스트 검색 -->
    <!--  검색안할 시 -->
    <select id="fullList" parameterType="com.cafe24.nonchrono.dto.PagingDTO" resultType="java.util.Map">
        <![CDATA[
        select od_num, ss_name, od_date, dt_prog, format(r, 0) as rnum
        from (
                select *, @rno := @rno + 1 as r
                from (
                        select *
                        from (
                                select od.od_num, ss_name, od_date, dt_prog
                                from tb_order od join tb_detail dt
                                on od.od_num = dt.od_num join tb_sales ts
                                on dt.ss_num = ts.ss_num
                                where sl_id = #{sl_id}
                        ) AA, (select @rno := 0) BB
                        order by od_date desc
                ) CC
        ) DD
        where r >= #{startRow} and r <= #{endRow}
        ]]>
    </select>

    <select id="fullTotalRowCount" parameterType="com.cafe24.nonchrono.dto.PagingDTO" resultType="int">
        select ifnull(max(count), 0) as cnt
        from (
            select count(*) as count
            from tb_order od join tb_detail dt
                                  on od.od_num = dt.od_num join tb_sales ts
                                                                on dt.ss_num = ts.ss_num
            where sl_id = #{sl_id}
            group by sl_id
        ) AA
    </select>

    <!--  진행상태만  -->
    <select id="progList" parameterType="com.cafe24.nonchrono.dto.PagingDTO" resultType="java.util.Map">
        <![CDATA[
        select od_num, ss_name, od_date, dt_prog, FORMAT(r,0) as rnum
        from (
                 select *, @rno := @rno + 1 as r
                 from (
                         select *
                         from (
                                 select od.od_num, ss_name, od_date, dt_prog
                                 from tb_order od join tb_detail dt
                                 on od.od_num = dt.od_num join tb_sales ts
                                 on dt.ss_num = ts.ss_num
                                 where sl_id = #{sl_id} and dt_prog = #{dt_prog}
                         ) AA, (select @rno := 0) BB
                         order by od_date desc
                     ) CC
             ) DD
        where r >= #{startRow} and r <= #{endRow}
        ]]>
    </select>

    <select id="progTotalRowCount" parameterType="com.cafe24.nonchrono.dto.PagingDTO" resultType="java.lang.Integer">
        select ifnull(max(count), 0) as cnt
        from (
                select count(*) as count
                from tb_order od join tb_detail dt
                                      on od.od_num = dt.od_num join tb_sales ts
                                                                    on dt.ss_num = ts.ss_num
                where sl_id = #{sl_id} and dt_prog = #{dt_prog}
                group by sl_id
            ) AA
    </select>

    <!--  시작일자만  -->
    <select id="speriodList" parameterType="com.cafe24.nonchrono.dto.PagingDTO" resultType="java.util.Map">
        <![CDATA[
        select od_num, ss_name, od_date, dt_prog, format(r, 0) as rnum
        from (
                 select *, @rno := @rno + 1 as r
                 from (
                         select *
                         from (
                                 select od.od_num, ss_name, od_date, dt_prog
                                 from tb_order od join tb_detail dt
                                 on od.od_num = dt.od_num join tb_sales ts
                                 on dt.ss_num = ts.ss_num
                                 where sl_id = #{sl_id} and (DATE_FORMAT(ss_speriod, '%Y-%m-%d') >= DATE_FORMAT(#{ss_speriod}, '%Y-%m-%d'))
                         ) AA, (select @rno := 0) BB
                         order by od_date desc
                     ) CC
             ) DD
        where r >= #{startRow} and r <= #{endRow}
        ]]>
    </select>

    <select id="speriodTotalRowCount" parameterType="com.cafe24.nonchrono.dto.PagingDTO" resultType="int">
        select ifnull(max(count), 0) as cnt
        from (
            select count(*) as count
            from tb_order od join tb_detail dt
                                  on od.od_num = dt.od_num join tb_sales ts
                                                                on dt.ss_num = ts.ss_num
            where sl_id = #{sl_id} and (DATE_FORMAT(ss_speriod, '%Y-%m-%d') >= DATE_FORMAT(#{ss_speriod}, '%Y-%m-%d'))
            group by sl_id
        ) AA
    </select>

    <!--  종료일자만  -->
    <select id="eperiodList" parameterType="com.cafe24.nonchrono.dto.PagingDTO" resultType="java.util.Map">
        <![CDATA[
        select od_num, ss_name, od_date, dt_prog, format(r, 0) as rnum
        from (
                 select *, @rno := @rno + 1 as r
                 from (
                         select *
                         from (
                                 select od.od_num, ss_name, od_date, dt_prog
                                 from tb_order od join tb_detail dt
                                 on od.od_num = dt.od_num join tb_sales ts
                                 on dt.ss_num = ts.ss_num
                                 where sl_id = #{sl_id} and DATE_FORMAT(ss_eperiod, '%Y-%m-%d') <= DATE_FORMAT(#{ss_eperiod}, '%Y-%m-%d')
                         ) AA, (select @rno := 0) BB
                         order by od_date desc
                     ) CC
             ) DD
        where r >= #{startRow} and r <= #{endRow}
        ]]>
    </select>

    <select id="eperiodTotalRowCount" parameterType="com.cafe24.nonchrono.dto.PagingDTO" resultType="int">
        <![CDATA[
        select ifnull(max(count), 0) as cnt
        from (
            select count(*) as count
            from tb_order od join tb_detail dt
            on od.od_num = dt.od_num join tb_sales ts
            on dt.ss_num = ts.ss_num
            where sl_id = #{sl_id} and DATE_FORMAT(ss_eperiod, '%Y-%m-%d') <= DATE_FORMAT(#{ss_eperiod}, '%Y-%m-%d')
            group by sl_id
        ) AA

        ]]>
    </select>

    <!--  시작, 종료일자 둘다  -->
    <select id="spepList" parameterType="com.cafe24.nonchrono.dto.PagingDTO" resultType="java.util.Map">
        <![CDATA[
        select od_num, ss_name, od_date, dt_prog, format(r, 0) as rnum
        from (
                 select *, @rno := @rno + 1 as r
                 from (
                         select *
                         from (
                                 select od.od_num, ss_name, od_date, dt_prog
                                 from tb_order od join tb_detail dt
                                 on od.od_num = dt.od_num join tb_sales ts
                                 on dt.ss_num = ts.ss_num
                                 where sl_id = #{sl_id} and (DATE_FORMAT(ss_speriod, '%Y-%m-%d') >= DATE_FORMAT(#{ss_speriod}, '%Y-%m-%d') and DATE_FORMAT(ss_eperiod, '%Y-%m-%d') <= DATE_FORMAT(#{ss_eperiod}, '%Y-%m-%d'))
                         ) AA, (select @rno := 0) BB
                         order by od_date desc
                     ) CC
             ) DD
        where r >= #{startRow} and r <= #{endRow}
        ]]>
    </select>

    <select id="spepTotalRowCount" parameterType="com.cafe24.nonchrono.dto.PagingDTO" resultType="int">
        <![CDATA[
        select ifnull(max(count), 0) as cnt
        from (
            select count(*) as count
            from tb_order od join tb_detail dt
            on od.od_num = dt.od_num join tb_sales ts
            on dt.ss_num = ts.ss_num
            where sl_id = #{sl_id} and (DATE_FORMAT(ss_speriod, '%Y-%m-%d') >= DATE_FORMAT(#{ss_speriod}, '%Y-%m-%d') and DATE_FORMAT(ss_eperiod, '%Y-%m-%d') <= DATE_FORMAT(#{ss_eperiod}, '%Y-%m-%d'))
            group by sl_id
        ) AA
        ]]>
    </select>

    <!--  조건검색만  -->
    <select id="ikList" parameterType="com.cafe24.nonchrono.dto.PagingDTO" resultType="java.util.Map">
        <![CDATA[
        select od_num, ss_name, od_date, dt_prog, format(r,0) as rnum
        from (
                 select *, @rno := @rno + 1 as r
                 from (
                         select *
                         from (
                                 select od.od_num, ss_name, od_date, dt_prog
                                 from tb_order od join tb_detail dt
                                 on od.od_num = dt.od_num join tb_sales ts
                                 on dt.ss_num = ts.ss_num
                                 where sl_id = #{sl_id} and ${inputState} like CONCAT('%', #{keyword}, '%')
                         ) AA, (select @rno := 0) BB
                         order by od_date desc
                     ) CC
             ) DD
        where r >= #{startRow} and r <= #{endRow}
        ]]>
    </select>

    <select id="ikTotalRowCount" parameterType="com.cafe24.nonchrono.dto.PagingDTO" resultType="int">
        select ifnull(max(count), 0) as cnt
        from (
                select count(*) as count
                from tb_order od join tb_detail dt
                                      on od.od_num = dt.od_num join tb_sales ts
                                                                    on dt.ss_num = ts.ss_num
                where sl_id = #{sl_id} and ${inputState} like CONCAT('%', #{keyword}, '%')
                group by sl_id
        ) AA
    </select>

    <!--  진행상태 & 시작일  -->
    <select id="psList" parameterType="com.cafe24.nonchrono.dto.PagingDTO" resultType="java.util.Map">
        <![CDATA[
        select od_num, ss_name, od_date, dt_prog, format(r, 0) as rnum
        from (
                 select *, @rno := @rno + 1 as r
                 from (
                         select *
                         from (
                                 select od.od_num, ss_name, od_date, dt_prog
                                 from tb_order od join tb_detail dt
                                 on od.od_num = dt.od_num join tb_sales ts
                                 on dt.ss_num = ts.ss_num
                                 where sl_id = #{sl_id} and dt_prog = #{dt_prog} and (DATE_FORMAT(ss_speriod, '%Y-%m-%d') >= DATE_FORMAT(#{ss_speriod}, '%Y-%m-%d'))
                         ) AA, (select @rno := 0) BB
                         order by od_date desc
                     ) CC
             ) DD
        where r >= #{startRow} and r <= #{endRow}
        ]]>
    </select>

    <select id="psTotalRowCount" parameterType="com.cafe24.nonchrono.dto.PagingDTO" resultType="int">
        <![CDATA[
        select ifnull(max(count), 0) as cnt
        from (
                select count(*) as count
                from tb_order od join tb_detail dt
                                      on od.od_num = dt.od_num join tb_sales ts
                                                                    on dt.ss_num = ts.ss_num
                where sl_id = #{sl_id} and dt_prog = #{dt_prog} and (DATE_FORMAT(ss_speriod, '%Y-%m-%d') >= DATE_FORMAT(#{ss_speriod}, '%Y-%m-%d'))
                group by sl_id
            ) AA
        ]]>
    </select>

    <!--  진행상태 & 종료일  -->
    <select id="peLIst" parameterType="com.cafe24.nonchrono.dto.PagingDTO" resultType="java.util.Map">
        <![CDATA[
        select od_num, ss_name, od_date, dt_prog, format(r, 0) as rnum
        from (
                 select *, @rno := @rno + 1 as r
                 from (
                         select *
                         from (
                                 select od.od_num, ss_name, od_date, dt_prog
                                 from tb_order od join tb_detail dt
                                 on od.od_num = dt.od_num join tb_sales ts
                                 on dt.ss_num = ts.ss_num
                                 where sl_id = #{sl_id} and dt_prog = #{dt_prog} and DATE_FORMAT(ss_eperiod, '%Y-%m-%d') <= DATE_FORMAT(#{ss_eperiod}, '%Y-%m-%d')
                         ) AA, (select @rno := 0) BB
                         order by od_date desc
                     ) CC
             ) DD
        where r >= #{startRow} and r <= #{endRow}
        ]]>
    </select>

    <select id="peTotalRowCount" parameterType="com.cafe24.nonchrono.dto.PagingDTO" resultType="int">
        <![CDATA[
        select ifnull(max(count), 0) as cnt
        from (
                select count(*) as count
                from tb_order od join tb_detail dt
                on od.od_num = dt.od_num join tb_sales ts
                on dt.ss_num = ts.ss_num
                where sl_id = #{sl_id} and dt_prog = #{dt_prog} and DATE_FORMAT(ss_eperiod, '%Y-%m-%d') <= DATE_FORMAT(#{ss_eperiod}, '%Y-%m-%d')
                group by sl_id
        ) AA
        ]]>
    </select>



    <select id="pseList" parameterType="com.cafe24.nonchrono.dto.PagingDTO" resultType="java.util.Map">
        <![CDATA[
        select od_num, ss_name, od_date, dt_prog, format(r, 0) as rnum
        from (
                 select *, @rno := @rno + 1 as r
                 from (
                         select *
                         from (
                                 select od.od_num, ss_name, od_date, dt_prog
                                 from tb_order od join tb_detail dt
                                 on od.od_num = dt.od_num join tb_sales ts
                                 on dt.ss_num = ts.ss_num
                                 where sl_id = #{sl_id} and dt_prog = #{dt_prog} and (DATE_FORMAT(ss_speriod, '%Y-%m-%d') >= DATE_FORMAT(#{ss_speriod}, '%Y-%m-%d') and DATE_FORMAT(ss_eperiod, '%Y-%m-%d') <= DATE_FORMAT(#{ss_eperiod}, '%Y-%m-%d'))
                         ) AA, (select @rno := 0) BB
                         order by od_date desc
                     ) CC
             ) DD
        where r >= #{startRow} and r <= #{endRow}
        ]]>
    </select>

    <select id="pseTotalRowCount" parameterType="com.cafe24.nonchrono.dto.PagingDTO" resultType="int">
        <![CDATA[
        select ifnull(max(count), 0) as cnt
        from (
                select count(*) as count
                from tb_order od join tb_detail dt
                on od.od_num = dt.od_num join tb_sales ts
                on dt.ss_num = ts.ss_num
                where sl_id = #{sl_id} and dt_prog = #{dt_prog} and (DATE_FORMAT(ss_speriod, '%Y-%m-%d') >= DATE_FORMAT(#{ss_speriod}, '%Y-%m-%d') and DATE_FORMAT(ss_eperiod, '%Y-%m-%d') <= DATE_FORMAT(#{ss_eperiod}, '%Y-%m-%d'))
                group by sl_id
        ) AA
        ]]>
    </select>

    <!-- 진행상태 & 조건 검색 -->
    <select id="pikList" parameterType="com.cafe24.nonchrono.dto.PagingDTO" resultType="java.util.Map">
        <![CDATA[
        select od_num, ss_name, od_date, dt_prog, format(r, 0) as rnum
        from (
                 select *, @rno := @rno + 1 as r
                 from (
                         select *
                         from (
                                 select od.od_num, ss_name, od_date, dt_prog
                                 from tb_order od join tb_detail dt
                                 on od.od_num = dt.od_num join tb_sales ts
                                 on dt.ss_num = ts.ss_num
                                 where sl_id = #{sl_id} and dt_prog = #{dt_prog} and ${inputState} like CONCAT('%', #{keyword}, '%')
                         ) AA, (select @rno := 0) BB
                         order by od_date desc
                     ) CC
             ) DD
        where r >= #{startRow} and r <= #{endRow}
        ]]>
    </select>

    <select id="pikTotalCount" parameterType="com.cafe24.nonchrono.dto.PagingDTO" resultType="int">
        select ifnull(max(count), 0) as cnt
        from (
                select count(*) as count
                from tb_order od join tb_detail dt
                                      on od.od_num = dt.od_num join tb_sales ts
                                                                    on dt.ss_num = ts.ss_num
                where sl_id = #{sl_id} and dt_prog = #{dt_prog} and ${inputState} like CONCAT('%', #{keyword}, '%')
                group by sl_id
        ) AA
    </select>

    <!-- 시작일 & 조건 검색 -->
    <select id="sikList" parameterType="com.cafe24.nonchrono.dto.PagingDTO" resultType="java.util.Map">
        <![CDATA[
        select od_num, ss_name, od_date, dt_prog, format(r, 0) as rnum
        from (
                 select *, @rno := @rno + 1 as r
                 from (
                         select *
                         from (
                                 select od.od_num, ss_name, od_date, dt_prog
                                 from tb_order od join tb_detail dt
                                 on od.od_num = dt.od_num join tb_sales ts
                                 on dt.ss_num = ts.ss_num
                                 where sl_id = #{sl_id} and ${inputState} like CONCAT('%', #{keyword}, '%') and (DATE_FORMAT(ss_speriod, '%Y-%m-%d') >= DATE_FORMAT(#{ss_speriod}, '%Y-%m-%d'))
                         ) AA, (select @rno := 0) BB
                         order by od_date desc
                     ) CC
             ) DD
        where r >= #{startRow} and r <= #{endRow}
        ]]>
    </select>

    <select id="sikTotalCount" parameterType="com.cafe24.nonchrono.dto.PagingDTO" resultType="int">
        <![CDATA[
        select ifnull(max(count), 0) as cnt
        from (
                select count(*) as count
                from tb_order od join tb_detail dt
                                      on od.od_num = dt.od_num join tb_sales ts
                                                                    on dt.ss_num = ts.ss_num
                where sl_id = #{sl_id} and ${inputState} like CONCAT('%', #{keyword}, '%') and (DATE_FORMAT(ss_speriod, '%Y-%m-%d') >= DATE_FORMAT(#{ss_speriod}, '%Y-%m-%d'))
                group by sl_id
        ) AA
        ]]>
    </select>

    <!-- 종료일 & 조건 검색 -->
    <select id="eikList" parameterType="com.cafe24.nonchrono.dto.PagingDTO" resultType="java.util.Map">
        <![CDATA[
        select od_num, ss_name, od_date, dt_prog, format(r, 0) as rnum
        from (
                 select *, @rno := @rno + 1 as r
                 from (
                         select *
                         from (
                                 select od.od_num, ss_name, od_date, dt_prog
                                 from tb_order od join tb_detail dt
                                 on od.od_num = dt.od_num join tb_sales ts
                                 on dt.ss_num = ts.ss_num
                                 where sl_id = #{sl_id} and ${inputState} like CONCAT('%', #{keyword}, '%') and DATE_FORMAT(ss_eperiod, '%Y-%m-%d') <= DATE_FORMAT(#{ss_epeirod}, '%Y-%m-%d')
                         ) AA, (select @rno := 0) BB
                         order by od_date desc
                     ) CC
             ) DD
        where r >= #{startRow} and r <= #{endRow}
        ]]>
    </select>

    <select id="eikTotalCount" parameterType="com.cafe24.nonchrono.dto.PagingDTO" resultType="int">
        <![CDATA[
        select ifnull(max(count), 0) as cnt
        from (
                select count(*) as count
                from tb_order od join tb_detail dt
                on od.od_num = dt.od_num join tb_sales ts
                on dt.ss_num = ts.ss_num
                where sl_id = #{sl_id} and  ${inputState} like CONCAT('%', #{keyword}, '%') and DATE_FORMAT(ss_eperiod, '%Y-%m-%d') <= DATE_FORMAT(#{ss_eperiod}, '%Y-%m-%d')
                group by sl_id
        ) AA
        ]]>
    </select>

    <!-- 시작일, 종료일 & 조건 검색 -->
    <select id="seikList" parameterType="com.cafe24.nonchrono.dto.PagingDTO" resultType="java.util.Map">
        <![CDATA[
        select od_num, ss_name, od_date, dt_prog, format(r, 0) as rnum
        from (
                 select *, @rno := @rno + 1 as r
                 from (
                         select *
                         from (
                                 select od.od_num, ss_name, od_date, dt_prog
                                 from tb_order od join tb_detail dt
                                 on od.od_num = dt.od_num join tb_sales ts
                                 on dt.ss_num = ts.ss_num
                                 where sl_id = #{sl_id} and ${inputState} like CONCAT('%', #{keyword}, '%') and (DATE_FORMAT(ss_speriod, '%Y-%m-%d') >= DATE_FORMAT(#{ss_speriod}, '%Y-%m-%d') and DATE_FORMAT(ss_eperiod, '%Y-%m-%d') <= DATE_FORMAT(#{ss_eperiod}, '%Y-%m-%d'))
                         ) AA, (select @rno := 0) BB
                         order by od_date desc
                     ) CC
             ) DD
        where r >= #{startRow} and r <= #{endRow}
        ]]>
    </select>

    <select id="seikTotalCount" parameterType="com.cafe24.nonchrono.dto.PagingDTO" resultType="int">
        <![CDATA[
        select ifnull(max(count), 0) as cnt
        from (
                select count(*) as count
                from tb_order od join tb_detail dt
                on od.od_num = dt.od_num join tb_sales ts
                on dt.ss_num = ts.ss_num
                where sl_id = #{sl_id} and ${inputState} like CONCAT('%', #{keyword}, '%') and (DATE_FORMAT(ss_speriod, '%Y-%m-%d') >= DATE_FORMAT(#{ss_speriod}, '%Y-%m-%d') and DATE_FORMAT(ss_eperiod, '%Y-%m-%d') <= DATE_FORMAT(#{ss_eperiod}, '%Y-%m-%d'))
                group by sl_id
        ) AA
        ]]>
    </select>

    <!-- 진행상태 & 시작일 & 조건검색 -->
    <select id="psikList" parameterType="com.cafe24.nonchrono.dto.PagingDTO" resultType="java.util.Map">
        <![CDATA[
        select od_num, ss_name, od_date, dt_prog, format(r, 0) as rnum
        from (
                 select *, @rno := @rno + 1 as r
                 from (
                         select *
                         from (
                                 select od.od_num, ss_name, od_date, dt_prog
                                 from tb_order od join tb_detail dt
                                 on od.od_num = dt.od_num join tb_sales ts
                                 on dt.ss_num = ts.ss_num
                                 where sl_id = #{sl_id} and dt_prog = #{dt_prog} and ${inputState} like CONCAT('%', #{keyword}, '%') and (DATE_FORMAT(ss_speriod, '%Y-%m-%d') >= DATE_FORMAT(#{ss_speriod}, '%Y-%m-%d'))
                         ) AA, (select @rno := 0) BB
                         order by od_date desc
                     ) CC
             ) DD
        where r >= #{startRow} and r <= #{endRow}
        ]]>
    </select>

    <select id="psikTotalCount" parameterType="com.cafe24.nonchrono.dto.PagingDTO" resultType="int">
        <![CDATA[
        select ifnull(max(count), 0) as cnt
        from (
                select count(*) as count
                from tb_order od join tb_detail dt
                                      on od.od_num = dt.od_num join tb_sales ts
                                                                    on dt.ss_num = ts.ss_num
                where sl_id = #{sl_id} and dt_prog = #{dt_prog} and ${inputState} like CONCAT('%', #{keyword}, '%') and (DATE_FORMAT(ss_speriod, '%Y-%m-%d') >= DATE_FORMAT(#{ss_speriod}, '%Y-%m-%d'))
                group by sl_id
        ) AA
        ]]>
    </select>

    <!-- 진행상태 & 종료일 & 조건검색 -->
    <select id="peikList" parameterType="com.cafe24.nonchrono.dto.PagingDTO" resultType="java.util.Map">
        <![CDATA[
        select od_num, ss_name, od_date, dt_prog, format(r, 0) as rnum
        from (
                 select *, @rno := @rno + 1 as r
                 from (
                         select *
                         from (
                                 select od.od_num, ss_name, od_date, dt_prog
                                 from tb_order od join tb_detail dt
                                 on od.od_num = dt.od_num join tb_sales ts
                                 on dt.ss_num = ts.ss_num
                                 where sl_id = #{sl_id} and dt_prog = #{dt_prog} and ${inputState} like CONCAT('%', #{keyword}, '%') and DATE_FORMAT(ss_eperiod, '%Y-%m-%d') <= DATE_FORMAT(#{ss_eperiod}, '%Y-%m-%d')
                         ) AA, (select @rno := 0) BB
                         order by od_date desc
                     ) CC
             ) DD
        where r >= #{startRow} and r <= #{endRow}
        ]]>
    </select>

    <select id="peikTotalRowCount" parameterType="com.cafe24.nonchrono.dto.PagingDTO" resultType="int">
        <![CDATA[
        select ifnull(max(count), 0) as cnt
        from (
                select count(*) as count
                from tb_order od join tb_detail dt
                on od.od_num = dt.od_num join tb_sales ts
                on dt.ss_num = ts.ss_num
                where sl_id = #{sl_id} and dt_prog = #{dt_prog} and ${inputState} like CONCAT('%', #{keyword}, '%') and DATE_FORMAT(ss_eperiod, '%Y-%m-%d') <= DATE_FORMAT(#{ss_eperiod}, '%Y-%m-%d')
                group by sl_id
        ) AA
        ]]>
    </select>

    <!-- 진행상태 & 시작,종료일 & 조건검색 -->
    <select id="pseikList" parameterType="com.cafe24.nonchrono.dto.PagingDTO" resultType="java.util.Map">
        <![CDATA[
        select od_num, ss_name, od_date, dt_prog, format(r, 0) as rnum
        from (
                 select *, @rno := @rno + 1 as r
                 from (
                         select *
                         from (
                                 select od.od_num, ss_name, od_date, dt_prog
                                 from tb_order od join tb_detail dt
                                 on od.od_num = dt.od_num join tb_sales ts
                                 on dt.ss_num = ts.ss_num
                                 where sl_id = #{sl_id} and dt_prog = #{dt_prog} and ${inputState} like CONCAT('%', #{keyword}, '%') and (DATE_FORMAT(ss_speriod, '%Y-%m-%d') >= DATE_FORMAT(#{ss_speriod}, '%Y-%m-%d') and DATE_FORMAT(ss_eperiod, '%Y-%m-%d') <= DATE_FORMAT(#{ss_eperiod}, '%Y-%m-%d'))
                         ) AA, (select @rno := 0) BB
                         order by od_date desc
                     ) CC
             ) DD
        where r >= #{startRow} and r <= #{endRow}
        ]]>
    </select>

    <select id="pseikTotalRowCount" parameterType="com.cafe24.nonchrono.dto.PagingDTO" resultType="int">
        <![CDATA[
        select ifnull(max(count), 0) as cnt
        from (
                select count(*) as count
                from tb_order od join tb_detail dt
                on od.od_num = dt.od_num join tb_sales ts
                on dt.ss_num = ts.ss_num
                where sl_id = #{sl_id} and dt_prog = #{dt_prog} and ${inputState} like CONCAT('%', #{keyword}, '%') and (DATE_FORMAT(ss_speriod, '%Y-%m-%d') >= DATE_FORMAT(#{ss_speriod}, '%Y-%m-%d') and DATE_FORMAT(ss_eperiod, '%Y-%m-%d') <= DATE_FORMAT(#{ss_eperiod}, '%Y-%m-%d'))
                group by sl_id
        ) AA
        ]]>
    </select>

    <select id="reviewList" resultType="com.cafe24.nonchrono.dto.ReviewDTO">
        select rv_num, mem_id, rv_star, rv.ss_num, rv_date, rv_content, rv_filename
        from tb_review rv join tb_sales sl
                               on rv.ss_num = sl.ss_num
        where sl_id = #{sl_id}
    </select>

    <select id="productInfo" resultType="com.cafe24.nonchrono.dto.SalesDTO">
        select ss_num, gm_code, sl_id, ss_name, ss_price, ss_speriod, ss_eperiod, ss_stock, ss_img, ss_status, ss_description, dv_num
        from tb_sales
        where ss_num = #{ss_num}
    </select>

    <update id="pdtUpdate" parameterType="com.cafe24.nonchrono.dto.SalesDTO">
        update tb_sales
        set gm_code = #{gm_code}, sl_id = #{sl_id}, ss_price = #{ss_price}, ss_speriod = #{ss_speriod}, ss_eperiod = #{ss_eperiod}, ss_stock = #{ss_stock}, ss_img = #{ss_img}, ss_status = #{ss_status},
            ss_description = #{ss_description}, dv_num = #{dv_num}, ss_name = #{ss_name}
        where ss_num = #{ss_num}
    </update>


</mapper>